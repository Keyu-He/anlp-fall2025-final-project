# Feature Steering å®éªŒæŒ‡å—

## ğŸ¯ å®éªŒç›®æ ‡

æ‰¹é‡æµ‹è¯• SAE feature steeringï¼ŒéªŒè¯ï¼š
1. **Steering æ˜¯å¦ work**ï¼šæ”¹å˜ feature æ¿€æ´»æ˜¯å¦çœŸçš„æ”¹å˜æ¨¡å‹è¾“å‡º
2. **æœ‰ä»€ä¹ˆå½±å“**ï¼šä¸åŒ features å¯¹ä¸åŒç»´åº¦çš„å½±å“
3. **æœ€ä½³é…ç½®**ï¼šå“ªäº› featuresã€strengthsã€åœºæ™¯ç»„åˆæœ€æœ‰æ•ˆ

## ğŸ“‹ æ¨èå®éªŒæµç¨‹

### é˜¶æ®µ 1ï¼šå¿«é€ŸéªŒè¯ï¼ˆ30-60åˆ†é’Ÿï¼‰

**ç›®çš„**ï¼šå¿«é€Ÿç¡®è®¤ steering æ˜¯å¦åŸºæœ¬æœ‰æ•ˆ

```bash
# è¿è¡Œå¿«é€ŸéªŒè¯æµ‹è¯•
python inferences/quick_validation_test.py
```

**æµ‹è¯•é…ç½®**ï¼š
- æ¯ä¸ªç»´åº¦é€‰ 1-2 ä¸ªæœ€å¼º features
- å›ºå®šå°å¼ºåº¦ (1.0)
- 5 ä¸ªä»£è¡¨æ€§åœºæ™¯
- çº¦ 15-20 ä¸ªæµ‹è¯•

**æŸ¥çœ‹ç»“æœ**ï¼š
```bash
# æŸ¥çœ‹ç”Ÿæˆçš„ summary
cat results/quick_validation/summary_*.md
```

**åˆ¤æ–­æ ‡å‡†**ï¼š
- âœ… å¦‚æœ **æœ‰æ•ˆç‡ > 50%**ï¼šsteering åŸºæœ¬æœ‰æ•ˆï¼Œç»§ç»­é˜¶æ®µ 2
- âš ï¸ å¦‚æœ **æœ‰æ•ˆç‡ 20-50%**ï¼šéƒ¨åˆ†æœ‰æ•ˆï¼Œå¯ä»¥ç»§ç»­ä½†éœ€è°ƒæ•´
- âŒ å¦‚æœ **æœ‰æ•ˆç‡ < 20%**ï¼šå¯èƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦æ£€æŸ¥é…ç½®

---

### é˜¶æ®µ 2ï¼šå•ç»´åº¦æ·±å…¥æµ‹è¯•ï¼ˆæ¯ä¸ªç»´åº¦ 1-2 å°æ—¶ï¼‰

**ç›®çš„**ï¼šæ·±å…¥æµ‹è¯•æœ€æœ‰æ•ˆçš„ç»´åº¦

é€‰æ‹©é˜¶æ®µ 1 ä¸­æœ€æœ‰æ•ˆçš„ç»´åº¦ï¼ˆå¦‚ relationshipï¼‰ï¼Œè¿›è¡Œå…¨é¢æµ‹è¯•ï¼š

```bash
# æµ‹è¯• relationship ç»´åº¦
python inferences/comprehensive_steering_test.py --dimension relationship

# æˆ–æµ‹è¯•å…¶ä»–ç»´åº¦
python inferences/comprehensive_steering_test.py --dimension believability
python inferences/comprehensive_steering_test.py --dimension knowledge
```

**æµ‹è¯•é…ç½®**ï¼š
- Top 3 features
- å¤šä¸ªå¼ºåº¦ï¼ˆ0.5, 1.0, 1.5, 2.0ï¼‰
- å¤šä¸ªåœºæ™¯ï¼ˆ4-6 ä¸ªï¼‰
- çº¦ 30-60 ä¸ªæµ‹è¯•

**åˆ†æç»“æœ**ï¼š
```bash
# ç”Ÿæˆåˆ†ææŠ¥å‘Š
python inferences/analyze_steering_results.py results/comprehensive_steering/comprehensive_relationship_*.jsonl
```

---

### é˜¶æ®µ 3ï¼šå…¨ç»´åº¦æµ‹è¯•ï¼ˆå¯é€‰ï¼Œ3-4 å°æ—¶ï¼‰

**ç›®çš„**ï¼šå…¨é¢äº†è§£æ‰€æœ‰ç»´åº¦çš„æ•ˆæœ

```bash
# æµ‹è¯•æ‰€æœ‰ç»´åº¦
python inferences/comprehensive_steering_test.py --dimension all
```

**æµ‹è¯•é…ç½®**ï¼š
- æ‰€æœ‰ç»´åº¦çš„ top features
- çº¦ 100-150 ä¸ªæµ‹è¯•

---

## ğŸ“Š ç»“æœåˆ†ææ–¹æ³•

### 1. è‡ªåŠ¨åˆ†ææŠ¥å‘Š

```bash
# å¯¹ä»»ä½• JSONL ç»“æœæ–‡ä»¶ç”Ÿæˆåˆ†ææŠ¥å‘Š
python inferences/analyze_steering_results.py <ç»“æœæ–‡ä»¶.jsonl>
```

æŠ¥å‘ŠåŒ…å«ï¼š
- æ€»ä½“ç»Ÿè®¡ï¼ˆæœ‰æ•ˆç‡ã€æˆåŠŸç‡ï¼‰
- å„ç»´åº¦æ•ˆæœå¯¹æ¯”
- Top features æ’å
- ä¸åŒå¼ºåº¦çš„æ•ˆæœ
- Top 10 æœ€æœ‰æ•ˆçš„æ¡ˆä¾‹

### 2. äººå·¥æŸ¥çœ‹é‡ç‚¹æ¡ˆä¾‹

æ‰“å¼€ç”Ÿæˆçš„ summary æˆ– analysis Markdown æ–‡ä»¶ï¼Œé‡ç‚¹çœ‹ï¼š

**åˆ¤æ–­ steering æ˜¯å¦æœ‰æ•ˆ**ï¼š
- âœ… Baseline å’Œ Steered è¾“å‡ºæ˜æ˜¾ä¸åŒ
- âœ… å˜åŒ–æ–¹å‘ç¬¦åˆé¢„æœŸï¼ˆå¦‚ relationship feature è®©è¾“å‡ºæ›´å‹å¥½ï¼‰
- âŒ è¾“å‡ºå®Œå…¨ç›¸åŒæˆ–åªæœ‰å¾®å°å·®å¼‚
- âŒ è¾“å‡ºè´¨é‡ä¸‹é™ï¼ˆé‡å¤ã€ä¸è¿è´¯ï¼‰

**åˆ¤æ–­å½±å“ç±»å‹**ï¼š
- **è¯­æ°”å˜åŒ–**ï¼šæ›´å‹å¥½/å†·æ·¡ã€æ›´æ­£å¼/éšæ„
- **å†…å®¹é‡ç‚¹**ï¼šæ›´å…³æ³¨å…³ç³»/åˆ©ç›Šã€æ›´æ³¨é‡ç»†èŠ‚/æ¦‚æ‹¬
- **å†³ç­–å€¾å‘**ï¼šæ›´åˆä½œ/ç«äº‰ã€æ›´å†’é™©/ä¿å®ˆ

### 3. å¯¹æ¯”åˆ†æ

å¦‚æœæœ‰ Sotopia è¯„åˆ†æ¨¡å‹ï¼Œå¯ä»¥ï¼š

```bash
# æå–æ‰€æœ‰ steered è¾“å‡º
jq -r '.steered_output' results/xxx.jsonl > steered_outputs.txt

# ç”¨ Sotopia è¯„åˆ†æ¨¡å‹è¯„ä¼°ï¼ˆéœ€è¦å•ç‹¬è¿è¡Œï¼‰
# å¯¹æ¯” baseline vs steered çš„å„ç»´åº¦åˆ†æ•°
```

---

## ğŸ” å¸¸è§å‘ç°ä¸è§£è¯»

### å‘ç° 1ï¼šè¾“å‡ºæœ‰å˜åŒ–ä½†æ–¹å‘ä¸ç¬¦åˆé¢„æœŸ

**å¯èƒ½åŸå› **ï¼š
- Feature çš„è¯­ä¹‰å¯èƒ½ä¸é¢„æœŸä¸å®Œå…¨ä¸€è‡´
- Feature åœ¨ä¸åŒåœºæ™¯ä¸‹å¯èƒ½æœ‰ä¸åŒä½œç”¨

**å»ºè®®**ï¼š
- æŸ¥çœ‹è¯¥ feature åœ¨å¤šä¸ªåœºæ™¯ä¸‹çš„æ•ˆæœ
- å°è¯•ä¸åŒçš„ steering æ–¹å‘ï¼ˆæ­£/è´Ÿï¼‰

### å‘ç° 2ï¼šæŸäº› features å®Œå…¨æ— æ•ˆ

**å¯èƒ½åŸå› **ï¼š
- è¯¥ feature çš„ baseline æ¿€æ´»å€¼æœ¬èº«å°±å¾ˆä½
- Feature å¯èƒ½åœ¨å…¶ä»–å±‚æˆ–å…¶ä»–ç±»å‹ä»»åŠ¡ä¸­æ›´æ´»è·ƒ

**å»ºè®®**ï¼š
- é‡ç‚¹å…³æ³¨ baseline æ¿€æ´»å€¼ > 0.1 çš„ features
- å°è¯•ä¸åŒçš„åœºæ™¯ç±»å‹

### å‘ç° 3ï¼šå¼º steering å¯¼è‡´è¾“å‡ºé‡å¤

**è§£å†³æ–¹æ³•**ï¼š
- é™ä½ steering strengthï¼ˆä½¿ç”¨ 0.5-1.5ï¼‰
- å‡å°‘ max_new_tokens
- å¢åŠ  temperatureï¼ˆå¦‚ 0.8-1.0ï¼‰

### å‘ç° 4ï¼šæŸä¸ªç»´åº¦æ•´ä½“æ•ˆæœå¥½

**è¯´æ˜**ï¼š
- è¯¥ç»´åº¦çš„ features è´¨é‡é«˜
- SAE æˆåŠŸæ•æ‰åˆ°äº†è¯¥ç»´åº¦çš„è¯­ä¹‰

**å»ºè®®**ï¼š
- å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†è¯¥ç»´åº¦çš„ sub-features
- å°è¯• feature ç»„åˆï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

---

## ğŸ’¡ å®éªŒå»ºè®®

### æ—¶é—´æœ‰é™çš„æƒ…å†µ

ä¼˜å…ˆçº§é¡ºåºï¼š
1. **å¿«é€ŸéªŒè¯**ï¼ˆå¿…åšï¼‰- 30 åˆ†é’Ÿ
2. **Relationship ç»´åº¦æ·±å…¥æµ‹è¯•** - 1 å°æ—¶
3. **Believability ç»´åº¦æ·±å…¥æµ‹è¯•** - 1 å°æ—¶
4. å…¶ä»–ç»´åº¦ï¼ˆå¯é€‰ï¼‰

### æƒ³è¦å‘è¡¨è®ºæ–‡çš„æƒ…å†µ

éœ€è¦ï¼š
1. **å…¨ç»´åº¦æµ‹è¯•** + **å¤šå¼ºåº¦å¯¹æ¯”**
2. **å®šé‡è¯„ä¼°**ï¼šç”¨ Sotopia è¯„åˆ†æ¨¡å‹è¯„ä¼°æ‰€æœ‰è¾“å‡º
3. **æ¶ˆèå®éªŒ**ï¼šå¯¹æ¯”ä¸åŒ featuresã€layersã€strengths
4. **Case Study**ï¼šæŒ‘é€‰å…¸å‹æ¡ˆä¾‹æ·±å…¥åˆ†æ

### åªæƒ³å¿«é€ŸéªŒè¯æƒ³æ³•

```bash
# ä¸€è¡Œå‘½ä»¤ï¼Œ15 åˆ†é’Ÿå‡ºç»“æœ
python inferences/quick_validation_test.py
```

ç„¶åæŸ¥çœ‹ `results/quick_validation/summary_*.md` æ–‡ä»¶ã€‚

---

## ğŸ“ˆ é¢„æœŸç»“æœ

æ ¹æ®ç°æœ‰ç ”ç©¶å’Œä½ çš„ CSV æ•°æ®ï¼Œé¢„æœŸï¼š

| ç»´åº¦ | é¢„æœŸæœ‰æ•ˆç‡ | åŸå›  |
|------|-----------|------|
| Relationship | 60-80% | é«˜ç›¸å…³æ€§ features (0.52+) |
| Believability | 40-60% | æé«˜ç›¸å…³æ€§ (-0.92) ä½†è´Ÿç›¸å…³ |
| Knowledge | 50-70% | ä¸­ç­‰ç›¸å…³æ€§ (0.48+) |
| Financial | 50-70% | é«˜ç›¸å…³æ€§ (0.54+) |
| Goal | 30-50% | ä¸­ç­‰è´Ÿç›¸å…³ (-0.50+) |

å¦‚æœå®é™…ç»“æœä¸é¢„æœŸç›¸å·®è¾ƒå¤§ï¼Œå¯èƒ½éœ€è¦ï¼š
- è°ƒæ•´ steering strength
- æ£€æŸ¥ SAE åŠ è½½æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ feature index æ˜¯å¦å¯¹åº”

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ‰€æœ‰æµ‹è¯•éƒ½å¤±è´¥

æ£€æŸ¥ï¼š
- æ¨¡å‹å’Œ SAE è·¯å¾„æ˜¯å¦æ­£ç¡®
- GPU å†…å­˜æ˜¯å¦è¶³å¤Ÿ
- Sotopia æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### é—®é¢˜ï¼šè¾“å‡ºå…¨éƒ¨é‡å¤

è§£å†³ï¼š
- é™ä½ `--max-new-tokens` åˆ° 64-100
- é™ä½ steering strength åˆ° 0.5-1.0
- å¢åŠ  temperature åˆ° 0.8-1.0

### é—®é¢˜ï¼šæœ‰æ•ˆç‡ä¸º 0%

æ£€æŸ¥ï¼š
- æ˜¯å¦æ‰€æœ‰è¾“å‡ºéƒ½å®Œå…¨ç›¸åŒï¼Ÿ
  - å¦‚æœæ˜¯ï¼šsteering å¯èƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ£€æŸ¥ hook æ˜¯å¦æ­£ç¡®
- Baseline feature æ¿€æ´»å€¼æ˜¯å¦éƒ½æ¥è¿‘ 0ï¼Ÿ
  - å¦‚æœæ˜¯ï¼šé€‰æ‹©æ¿€æ´»å€¼æ›´é«˜çš„ features

---

## ğŸ“ å¿«é€Ÿå¼€å§‹å‘½ä»¤

```bash
# 1. å¿«é€ŸéªŒè¯ï¼ˆæ¨èå…ˆåšè¿™ä¸ªï¼‰
python inferences/quick_validation_test.py

# 2. æŸ¥çœ‹ç»“æœ
cat results/quick_validation/summary_*.md

# 3. å¦‚æœæœ‰æ•ˆï¼Œæ·±å…¥æµ‹è¯•æŸä¸ªç»´åº¦
python inferences/comprehensive_steering_test.py --dimension relationship

# 4. åˆ†æç»“æœ
python inferences/analyze_steering_results.py results/comprehensive_steering/comprehensive_relationship_*.jsonl

# 5. æŸ¥çœ‹åˆ†ææŠ¥å‘Š
cat results/comprehensive_steering/comprehensive_relationship_*_analysis.md
```

---

**æœ€åæ›´æ–°**: 2025-12-03
